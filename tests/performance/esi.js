var console = require('console');
var util = require('util');

var testName = "ESI processing test";
var testIterations = new Array(1, 100, 1000, 10000);

// www.squiz.co.uk
var html = "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"> <html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\"> <head> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /> <meta name=\"verify-v1\" content=\"AseITDuNPlidhl6F5DTRQSOa/YaJc8STBmWC1nJxa90=\" /> <meta name=\"google-site-verification\" content=\"SuAVcWoyAb6vVnKzFUpem3SudXWVHbeKybmiLqwtSY8\" /> <meta name=\"msvalidate.01\" content=\"298324D2BAF5196847A21EC6993DE72E\" /> <link rel=\"alternate\" type=\"application/rss+xml\" title=\"Squiz UK News\" href=\"http://feeds.feedburner.com/SquizUKLatestNews\" /> <link rel=\"alternate\" type=\"application/rss+xml\" title=\"Squiz UK Blog\" href=\"http://feeds.feedburner.com/SquizUKBlog\" /> <title> Squiz UK: Open Source CMS &amp; Web Experience Management</title>  			<!-- General //--><esi:include src=\"http://www.squiz.co.uk/foo\" /> <!-- Squiz UK //--> <esi:include src=\"http://www.squiz.co.uk/foo\" /><meta name=\"keywords\" lang=\"en\" content=\"Open Source CMS &amp;amp; Web Experience Management, Home, squiz, cms, mysource, matrix, mysource matrix, open source, web, development, content management system, web publishing, web services, uk web agency, open source content management, open source web content management, open source content management system, open source content management software, open source cms news, open source simple CMS, open source cms modules, web experience management, enterprise search, web engagement management, web analytics, website search, funnelback\" /> <meta name=\"description\" lang=\"en\" content=\"Our open source web experience management suite includes a content management system, analytics, website search &amp; integration tools.\" /> <meta name=\"synopsis\" lang=\"en\" content=\"\" /> <meta name=\"url_link\" content=\"\" /> <meta name=\"datefield\" content=\"31/07/2009\" /> <meta name=\"Title\" content=\"Open Source CMS &amp;amp; Web Experience Management\" />  			<!--noindex-->  						<link rel=\"stylesheet\" type=\"text/css\" href=\"http://cdn.squiz.co.uk/assets/file/0016/26035/global.css\" media=\"all\" /> 								<link rel=\"stylesheet\" type=\"text/css\" href=\"http://www.squiz.co.uk/_designs/squiz-new-design/css/home.css\" media=\"all\" /> 								<link rel=\"stylesheet\" type=\"text/css\" href=\"http://cdn.squiz.co.uk/assets/file/0015/30606/sifr-screen-styles.css\" media=\"screen\" /> 								<link rel=\"stylesheet\" type=\"text/css\" href=\"http://cdn.squiz.co.uk/assets/file/0013/30604/sifr-print-styles.css\" media=\"print\" /> 								  <script src=\"http://cdn.squiz.co.uk/assets/text_file/0008/27377/utilities.js\" type=\"text/javascript\"></script> <script src=\"http://cdn.squiz.co.uk/assets/text_file/0010/27883/country_select.js\" type=\"text/javascript\"></script> <script src=\"http://cdn.squiz.co.uk/assets/text_file/0003/28092/swfobject.js\" type=\"text/javascript\"></script> <!-- <script src=\"http://cdn.squiz.co.uk/assets/file/0017/30608/sifr.js\" type=\"text/javascript\"></script> --> <!--[if IE 6]> 						<link rel=\"stylesheet\" type=\"text/css\" href=\"http://cdn.squiz.co.uk/assets/file/0018/26037/ie6.css\" media=\"all\" />								<script src=\"http://cdn.squiz.co.uk/assets/file/0019/32365/ie6_hover.js\" type=\"text/javascript\"  ></script><![endif]--> <!--[if IE 7]> 						<link rel=\"stylesheet\" type=\"text/css\" href=\"http://cdn.squiz.co.uk/assets/file/0017/26162/ie7.css\" media=\"all\" />								<![endif]-->  <link rel=\"shortcut icon\" href=\"http://cdn.squiz.co.uk/assets/file/0020/50645/favicon.ico\" type=\"image/x-icon\" />  <!--[if IE]><link id=\"ie_responsive\" rel=\"stylesheet\" type=\"text/css\" href=\"default_ie.css\" /><![endif]-->   <!--  Running MySource Matrix  Developed by Squiz - http://www.squiz.net  MySource, MySource Matrix and Squiz.net are registered Trademarks of Squiz Pty Ltd  Page generated: 04 June 2011 16:23:17-->    </head> <body>  <div class=\"hide\"><a name=\"top\"></a>  <p>The following links are provided for users who are using assistive technologies  such as screen readers and for users who would prefer to navigate with the  keyboard</p>  <ul>   <li><a href=\"#main_content\">Skip to main content</a></li>   <li><a href=\"#navigation\">Skip to site navigation</a></li>  </ul>  <p>There is also a back to top of page link at the end of all pages</p> </div> <div id=\"outer_wrapper\">  <div id=\"inner_wrapper\" class=\"font-size-toggle\">  <h1 style=\"position:absolute; top:-99999px\">Squiz - Open Source CMS (Content Management System) Solutions</h1>  <img id=\"logo\" src=\"http://cdn.squiz.co.uk/assets/image/0020/57413/squiz_logo.png\" alt=\"squiz\"/>   			 <ul id=\"region_nav\">        <li><a href=\"http://www.squiz.net\">Squiz Portal</a></li>        <li><a href=\"http://squiz.com.au\">Australia</a></li>        <li class=\"selected\"><a href=\"http://www.squiz.co.uk\">UK</a></li>        <li><a href=\"http://www.squiz.co.nz\">New Zealand</a></li>        <li><a href=\"http://www.squiz.pl\">Poland</a></li>        <li><a href=\"http://www.squizsuite.net/\">Squiz Suite</a></li>        <li><a href=\"http://www.squiz.co.uk/extranet-login\">Log in</a></li>    </ul>			    <!--CLOSE REGION NAV-->   <a name=\"navigation\"></a>   		   <ul id=\"nav\" class=\"font-size-toggle\">      <li  class=\"lvl_1\"> <a class=\"lvl_1\" href=\"http://www.squiz.co.uk/about\"> <span>      About Us     </span> </a>      		      <ul>                <li> <a href=\"http://www.squiz.co.uk/about/about-supported-open-source-cms\">          Supported Open Source         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/about/management\">          Management Team         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/about/partners\">          Partners         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/about/careers\">          Careers         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/about/contact\">          Contact Us         </a> </li>              </ul>      						     </li>      <li  class=\"lvl_1\"> <a class=\"lvl_1\" href=\"http://www.squiz.co.uk/squiz-suite\"> <span>      Products     </span> </a>      		      <ul>                <li> <a href=\"http://www.squiz.co.uk/squiz-suite/squiz-matrix\">          Squiz Matrix         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/squiz-suite/squiz-cms\">          Squiz CMS         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/squiz-suite/squiz-analytics\">          Squiz Analytics         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/squiz-suite/squiz-search\">          Squiz Search         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/squiz-suite/funnelback-enterprise-search\">          Enterprise Search         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/squiz-suite/email-campaign-manager\">          Email Campaign Manager         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/squiz-suite/resources\">          Resources         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/squiz-suite/reviews\">          Analyst Reviews         </a> </li>              </ul>      						     </li>      <li  class=\"lvl_1\"> <a class=\"lvl_1\" href=\"http://www.squiz.co.uk/services\"> <span>      Services     </span> </a>      		      <ul>                <li> <a href=\"http://www.squiz.co.uk/services/consulting\">          Consultancy &amp; Project Management         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/services/web-site-design\">          Website Design         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/services/development-and-implementation\">          Development &amp; Implementation         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/services/support\">          Support &amp; SLAs         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/services/client-services\">          Client Services         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/services/training\">          Training         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/services/hosting\">          Hosting         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/services/social-media-services\">          Social Media Services         </a> </li>              </ul>      						     </li>      <li  class=\"lvl_1\"> <a class=\"lvl_1\" href=\"http://www.squiz.co.uk/news-and-events\"> <span>      News &amp; Events     </span> </a>      		      <ul>                <li> <a href=\"http://www.squiz.co.uk/news-and-events/news\">          News         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/news-and-events/blog\">          Blog         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/news-and-events/events\">          Events         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/news-and-events/white-papers\">          White Papers         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/news-and-events/reviews\">          Analyst Reviews         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/news-and-events/resources\">          Resources         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/news-and-events/squiz-newsletter\">          Squiz Newsletter         </a> </li>              </ul>      						     </li>      <li  class=\"lvl_1\"> <a class=\"lvl_1\" href=\"http://www.squiz.co.uk/clients\"> <span>      Clients     </span> </a>      		      <ul>                <li> <a href=\"http://www.squiz.co.uk/clients/case-studies\">          Case Studies         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/clients/testimonials\">          Testimonials         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/clients/charities\">          Charities, Associations and Not For Profit         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/clients/government-and-public-sector\">          Government &amp; Public Sector         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/clients/education\">          Education         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/clients/media\">          Media &amp; Publishing         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/clients/finance\">          Finance         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/clients/consumer-brands\">          Consumer Brands         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/clients/travel\">          Travel &amp; Tourism         </a> </li>                <li> <a href=\"http://www.squiz.co.uk/clients/science\">          Science &amp; Technology         </a> </li>              </ul>      						     </li>        </ul>    <!--CLOSE NAV-->   						<!--endnoindex-->   <div id=\"content_wrapper\">       <div id=\"main_content_wrapper\">     <div class=\"box_content\">      <div id=\"main_content_home\"> <a name=\"main_content\"></a>             		<div id=\"banner-main\" style=\"position:relative;\">  <div id=\"banner-carousel\">	<ul>           <li class=\"first\">			            <a href=\"http://www.squiz.co.uk/squiz-suite\"><img src=\"http://cdn.squiz.co.uk/assets/image/0010/55558/Squiz-Suite-Banner.jpg\" width=\"687\" height=\"282\" alt=\"The Squiz Suite is a Supported Open Source Web Experience Management Suite which includes a content management system, analytics, website search and integration tools.\" title=\"Squiz-Suite-Banner.jpg\" /></a></li><li>			            <a href=\"http://www.squiz.co.uk/services\"><img src=\"http://cdn.squiz.co.uk/assets/image/0009/55557/Squiz-Services-Banner.jpg\" width=\"687\" height=\"282\" alt=\"\" title=\"Squiz-Services-Banner.jpg\" /></a></li>        </ul>  </div>  <div id=\"navbuttons\" style=\"position:absolute;bottom:10px;left:12px;z-index:100;\">	    <a class=\"car_1\" id=\"car_1\">1</a>    <a class=\"car_2\" id=\"car_2\">2</a>    <!--<a class=\"car_3\" id=\"car_3\">3</a>-->    <!--a class=\"car_4\" id=\"car_4\">4</a-->  </div></div>		<div id=\"home-carousel-wrapper\"><div id=\"home-carousel\">    <ul>        <li>    <a href=\"http://www.squiz.co.uk/news-and-events/news/emap-selects-mysource-matrix-open-source-cms-for-new-emap-networks-web-site-publishing-platform\">        <!--[if !IE 6]><!-->        <img alt=\"EMAP logo\" src=\"http://cdn.squiz.co.uk/assets/image/0007/52198/emap.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"Emap logo\" src=\"http://cdn.squiz.co.uk/assets/image/0017/52352/emap_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>Emap</h4>             <p>Emap use Squiz Products for its Emap Networks Website Publishing Platform.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/clients/consumer-brands\">        <!--[if !IE 6]><!-->        <img alt=\"\" src=\"http://cdn.squiz.co.uk/assets/image/0007/57355/skype.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"\" src=\"http://cdn.squiz.co.uk/assets/image/0007/57472/skype_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>Skype</h4>             <p>Skype use Funnelback Search on their website to deliver accurate results and to promote the company's products and services.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/clients/case-studies/digital-uk\">        <!--[if !IE 6]><!-->        <img alt=\"Digital Uk logo\" src=\"http://cdn.squiz.co.uk/assets/image/0005/52196/duk.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"Digital Uk logo\" src=\"http://cdn.squiz.co.uk/assets/image/0015/52350/duk_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>Digital UK</h4>             <p>Squiz helped Digital UK to communicate a large amount of complex information, effectively and consistently through their websites.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/news-and-events/blog/posts/the-great-open-source-web-cms-debate-presentation-by-richard-morgan-of-the-v-and-a-museum\">        <!--[if !IE 6]><!-->        <img alt=\"Victoria & Albert Museum logo\" src=\"http://cdn.squiz.co.uk/assets/image/0011/52202/va.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"Victoria & Albert Museum logo\" src=\"http://cdn.squiz.co.uk/assets/image/0020/52355/va_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>The Victoria &amp; Albert Museum</h4>             <p>The Victoria & Albert Museum highlighted the reasons for selecting an Open Source CMS at a recent Squiz Seminar.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/clients/case-studies/oxford-university-library-services\">        <!--[if !IE 6]><!-->        <img alt=\"Oxford University Library Services logo\" src=\"http://cdn.squiz.co.uk/assets/image/0008/52199/ox.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"Oxford University logo\" src=\"http://cdn.squiz.co.uk/assets/image/0018/52353/ox_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>The University of Oxford</h4>             <p>Oxford University Library Services simplified the process of publishing and maintaining their online portals with MySource Matrix CMS.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/clients/case-studies/electoral-commission\">        <!--[if !IE 6]><!-->        <img alt=\"The Electoral Commission logo\" src=\"http://cdn.squiz.co.uk/assets/image/0006/52197/ec.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"Electoral Commission logo\" src=\"http://cdn.squiz.co.uk/assets/image/0016/52351/ec_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>The Electoral Commission</h4>             <p>How the Electoral Commission made its information more accessible and improved customer service with Funnelback Website Search.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/clients/government-and-public-sector\">        <!--[if !IE 6]><!-->        <img alt=\"Drinkaware logo\" src=\"http://cdn.squiz.co.uk/assets/image/0004/52195/da.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"Drinkaware logo\" src=\"http://cdn.squiz.co.uk/assets/image/0005/52349/da_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>Drinkaware</h4>             <p>The Drinkaware Trust used MySource Matrix CMS for their, highly accessible website.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/clients/case-studies/royal-college-of-nursing\">        <!--[if !IE 6]><!-->        <img alt=\"Royal College of Nursing logo\" src=\"http://cdn.squiz.co.uk/assets/image/0009/52200/rcn.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"Royal College of Nursing logo\" src=\"http://cdn.squiz.co.uk/assets/image/0019/52354/rcn_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>Royal College of Nursing</h4>             <p>How MySource Matrix Open Source CMS helped the Royal College of Nursing achieve its aim of a robust new website with scope for growth.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/clients/case-studies/westminster-abbey\">        <!--[if !IE 6]><!-->        <img alt=\"Westminster Abbey logo\" src=\"http://cdn.squiz.co.uk/assets/image/0012/52203/wa.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"Westminster Abbey logo\" src=\"http://cdn.squiz.co.uk/assets/image/0003/52356/wa_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>Westminster Abbey</h4>             <p>How Squiz and Squiz Products brought increased functionality and sociability to Westminster Abbeyâ€™s new website.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/news-and-events/news/university-of-westminster-launches-new-website-on-mysource-matrix-open-source-cms\">        <!--[if !IE 6]><!-->        <img alt=\"University of Westminster logo\" src=\"http://cdn.squiz.co.uk/assets/image/0010/52201/wu.png\" width=\"130\" height=\"50\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"Westminster University Logo\" src=\"http://cdn.squiz.co.uk/assets/image/0004/52357/wu_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>University of Westminster</h4>             <p>The University of Westminster co-developed and implemented their new site in only eight weeks with MySource Matrix CMS.</p>        </div>    </a></li><li>    <a href=\"http://www.squiz.co.uk/clients/media\">        <!--[if !IE 6]><!-->        <img alt=\"British Medical Journal\" src=\"http://cdn.squiz.co.uk/assets/image/0007/53890/bmj.png\" width=\"95\" height=\"52\"/>        <!--<![endif]-->               <!--[if IE 6]><img alt=\"British Medical Journal\" src=\"http://cdn.squiz.co.uk/assets/image/0019/53902/bmj_ie6.png\" width=\"130\" height=\"50\" />       <![endif]-->       <div class=\"carousel-extra\">             <h4>British Medical Journal</h4>             <p>The British Medical Journal Group uses Funnelback to search its vast collection of online medical publications.</p>        </div>    </a></li>    </ul></div></div>     </div>          </div>     <!--close box content-->     <div class=\"bottom_curve\"></div>    </div>    <!--close main content wrapper-->    <div id=\"right_column\">     			<ul class=\"sm_tool\"><li><a class=\"facebook_icon\" title=\"Become our fan on Facebook\" href=\"http://www.facebook.com/pages/Squiz/167452666638850?ref=ts&amp;sk=wall\">Become our fan on Facebook</a></li><li><a class=\"twitter_icon\" title=\"Follow us on Twitter\" href=\"http://twitter.com/SquizUK\">Follow us on Twitter</a></li><li><a class=\"linkedin_icon\" title=\"Join us on LinkedIn\" href=\"http://www.linkedin.com/groups?gid=877607\">Join us on LinkedIn</a></li></ul><esi:include src=\"http://www.squiz.co.uk/foo\" /><!--ul class=\"tools\">  <li class=\"no_border\"><a class=\"text-transform\" href=\"#\" onclick=\"toggleFontSize();\" title=\"Resize Text\">Resize Text</a></li>  <li><a class=\"printer\" href=\"?SQ_DESIGN_NAME=printer_friendly\" title=\"Printer Friendly Design\" onclick=\"window.open('?SQ_DESIGN_NAME=printer_friendly'); return false\">Printer Friendly Design</a></li>  <li><a class=\"login\" href=\"http://www.squiz.co.uk/extranet-login\" title=\"Client Login\">Client Login</a></li></ul--><esi:include src=\"http://www.squiz.co.uk/foo\" />    <form id=\"fb_site\" name=\"fb_site\" action=\"http://www.squiz.co.uk/search\" method=\"get\">    <p>        <label for=\"query\">Search</label>         <input type=\"hidden\" name=\"gfacet_1\" value=\"1\" />         <input type=\"hidden\" value=\"squiz-uk\" name=\"collection\" />         <input type=\"text\" id=\"query\" class=\"sq-form-field\" size=\"5\" name=\"query\" />         <span class=\"button\"><input type=\"submit\" value=\"Go\" /> </span>     </p></form>			        <div class=\"box_content\">      			<esi:include src=\"http://www.squiz.co.uk/foo\" /><div id=\"content_div_46422\"><h2 class=\"whats_new\">Latest News</h2><div id=\"whats_new\" class=\"font-size-toggle\">                <esi:include src=\"http://www.squiz.co.uk/foo\" /><div id=\"content_div_46419\"><h3><a href=\"http://www.squiz.co.uk/news-and-events/blog/the-eu-cookie-directive\">The EU Cookie Directive</a></h3><p>The EU's controversial cookie directive came into effect last week, requiring that organisations must now get consent from website visitors before they can use cookies to store information about them. However, UK businesses are concerned that protecting the privacy of users may be at the expense of website usability...</p><p><a href=\"http://www.squiz.co.uk/news-and-events/blog/the-eu-cookie-directive\">Read more...</a></p></div></div><div id=\"page_nav\">                <ul><li class=\"no_border\">Prev</li><li><a href=\"http://www.squiz.co.uk/?result_46414_result_page=2\">Next</a></li></ul></div></div>       <ul id=\"buttons\">                <li class=\"demo\"><a href=\"http://www.squiz.co.uk/about/contact\">Book a Demo</a></li>                <li class=\"training\"><a href=\"http://www.squiz.co.uk/services/training\">Book Training</a></li>            </ul>			    </div>     <!--CLOSE BOX CONTENT-->    </div>    <!--CLOSE RIGHT COLUMN-->    <div id=\"secondary_nav\" class=\"font-size-toggle\">     			 <div class=\"box\">           <div id=\"suite\" class=\"new_box_content\">                     <h3><a href=\"http://www.squiz.co.uk/squiz-suite\">The Squiz Suite</a></h3>                    <p>Our Web Experience Management Suite is an advanced set of tools which enable organisations to create, manage and optimise their online presence.</p>                </div>                <div class=\"bottom_curve\"></div>            </div>                        <div class=\"box\">                <div id =\"cms\" class=\"new_box_content\">                     <h3><a href=\"http://www.squiz.co.uk/squiz-suite/squiz-cms\">Squiz CMS</a></h3>                    <p>Squiz CMS is a revolutionary content management system with a highly usable interface which makes it easy to create, publish and maintain websites.</p>                </div>                <div class=\"bottom_curve\"></div>            </div><esi:include src=\"http://www.squiz.co.uk/foo\" />            <div class=\"box\">                <div id=\"search\" class=\"new_box_content\">                     <h3><a href=\"http://www.squiz.co.uk/squiz-suite/squiz-search\">Squiz Search</a></h3>                    <p>Squiz Search delivers high quality search results, contextual and faceted navigation and can be used to create search based applications.</p>                </div>                <div class=\"bottom_curve\"></div>            </div><esi:include src=\"http://www.squiz.co.uk/foo\" />            <div class=\"box\">                <div id=\"analytics\" class=\"new_box_content\">                    <h3><a href=\"http://www.squiz.co.uk/squiz-suite/squiz-analytics\">Squiz Analytics</a></h3>                    <p>Squiz Analytics offers innovative tools to help optimise website content. Goal tracking, A/B/C testing and site monitoring has never been easier.</p>                </div>                <div class=\"bottom_curve\"></div>            </div><!--CLOSE BOX-->			   </div>    <!--CLOSE CONTENT WRAPPER-->   <!--noindex-->   </div>   <!--CLOSE INNER WRAPPER-->  </div>  <!--CLOSE OUTER WRAPPER-->  <div id=\"footer\"><a class=\"hide\" href=\"#top\">Back to top of page</a>   			    <ul id=\"footer_links\">        <li class=\"right_space\">            &copy; Squiz 2011        </li>        <li>            <a href=\"http://www.squiz.co.uk/about/contact\">Contact</a>        </li>        <li>            <a href=\"http://www.squiz.co.uk/site-map\">Site Map</a>        </li>        <li>            <a href=\"http://www.squiz.co.uk/privacy-policy\">Privacy Policy</a>        </li><li><a href=\"#\" onclick=\"toggleFontSize();\" title=\"Resize Text\">Resize Text</a></li>  <li><a href=\"?SQ_DESIGN_NAME=printer_friendly\" title=\"Printer Friendly\" onclick=\"window.open('?SQ_DESIGN_NAME=printer_friendly'); return false\">Printer Friendly</a></li>        <li>             <a href=\"http://www.squiz.co.uk/squiz-suite\">Powered by the Squiz Suite</a>        </li>        <li>             <a href=\"http://m.squiz.co.uk\">Mobile</a>        </li>    </ul> <ul class=\"contacts\">        <li> <span>London, England</span>+44 20 7101 8300</li>        <li> <span>Edinburgh, Scotland</span>+44 131 510 0350</li>        <li> <span>Szczecin, Poland</span>+48 91 885 6051</li>        <li> <span>Sydney, Australia</span>+61 2 8507 9900</li>        <li> <span>Wellington, New Zealand</span>+64 4 805 0098</li>        <li> <span>New York, USA</span>+1 646 328 0950</li>        <li> <span>24/7 Support</span>+44 20 7183 6801</li>    </ul>			 </div> </div> <esi:include src=\"http://www.squiz.co.uk/foo\" /><!--CLOSE FOOTER--> <script type=\"text/javascript\">  //sIFR.setup();//if(typeof sIFR == \"function\"){    //sIFR.replaceElement(\"h2\", named({sFlashSrc: \"/__data/assets/file/0018/30609/helveticaCondensed.swf\", sColor: \"#000\", sWmode:\"transparent\"}));//}; //sIFRAccessibility(\"h2\"); </script>   			<script src=\"http://cdn.squiz.co.uk/assets/js_file/0019/52255/jquery-1.4.2.min.js\" type=\"text/javascript\"></script><script src=\"http://cdn.squiz.co.uk/assets/js_file/0018/52326/jMyCarousel.min.js\" type=\"text/javascript\"></script><script src=\"http://cdn.squiz.co.uk/assets/js_file/0020/52256/home_banner.js\" type=\"text/javascript\"></script><script src=\"http://cdn.squiz.co.uk/assets/js_file/0020/53255/main_carousel.js\" type=\"text/javascript\"></script><esi:include src=\"http://www.squiz.co.uk/foo\" /><script type=\"text/javascript\">/*------ Main Banner  ------------*/var MAIN_BANNER = function(){return MAIN_BANNER;};	(function($){						MAIN_BANNER.newsCarousel = function(){			$(\"#navbuttons\").css(\"visibility\", \"visible\");			return MAIN_BANNER.carouselControls = $(\"#banner-carousel ul\").newsCarousel({				navButtons: $(\"#navbuttons a\"),				transition: \"fade\"			});		};		jQuery(function(){			if(jQuery(\"#banner-carousel ul\").length){				MAIN_BANNER.newsCarousel();	                        $(\"#car_1\").attr(\"class\", \"on_car\");			}			});	}).call(MAIN_BANNER, jQuery);</script><esi:include src=\"http://www.squiz.co.uk/foo\" /><script type=\"text/javascript\" src=\"http://www.squiz.co.uk/_designs/squiz-new-design/scripts/search_fld_clr.js\"></script><!-- GOOGLE ANALYTICS START--> <script type=\"text/javascript\">var gaJsHost = ((\"https:\" == document.location.protocol) ? \"https://ssl.\" : \"http://www.\");document.write(unescape(\"%3Cscript src='\" + gaJsHost + \"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E\"));</script><script type=\"text/javascript\">try {var pageTracker = _gat._getTracker(\"UA-352637-1\");pageTracker._trackPageview();} catch(err) {};</script><!-- GOOGLE ANALYTICS END --><!-- OPENTRACKER HTML START --><script type=\"text/javascript\" defer=\"defer\" src=\"http://server1.opentracker.net/?site=www.squiz.co.uk\"></script><noscript><p><a href=\"http://www.opentracker.net\"><img src=\"http://img.opentracker.net/?cmd=nojs&amp;site=www.squiz.co.uk\" alt=\"site monitor\" /></a></p></noscript><!-- OPENTRACKER HTML END -->  <!--endnoindex-->   </body></html> ";

console.log("\n---\nTest: " + testName + "\n---\n");

for (var t=0, l=testIterations.length; t<l; t++) {

	// Start time
	var startTime = (new Date()).getTime();
	
	// Test init
	var testDate = new Date();
	
	// Run test
	for (var i=0; i<testIterations[t]; i++) {
		esitest(html);
	}
	
	// End time
	var endTime = (new Date()).getTime();
	var totalTime = (endTime - startTime);
	
	// Print results
	console.log("Iterations: " + testIterations[t] + "; Time: " + totalTime + " ms");

}

function esitest(html) {

	var esiMatch = /<\s*esi:include(?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*\s*\/?>/g;
	var srcAttrMatch = /(src=["'])(.*?)["']/g;
	
	var esiTags = html.match(esiMatch);
	var documentFragments = html.split(esiMatch);
	
	var esiFragments = [];
	
	// Parse esi tags
	for (var i=0, l=esiTags.length; i<l; i++) {
		esiFragments[i] = {};
		esiFragments[i].tag = esiTags[i];
		delete(esiTags[i]);
		// Shame JS regexp doens't support lookbehind
		esiFragments[i].src = esiFragments[i].tag.match(srcAttrMatch)[0].replace(srcAttrMatch, function($0, $1, $2) {
			return $2;
		});
	}
	
	delete(esiTags);
	
	// Fetch resources for each object
	for (var i=0, l=esiFragments.length; i<l; i++) {
		esiFragments[i].data = fetch(esiFragments[i].src);
	}
	
	// Reconstruct document
	html = "";
	for (var i=0, l=documentFragments.length; i<l; i++) {
		html += documentFragments[i];
		if (typeof(esiFragments[i]) !== 'undefined') {
			html += esiFragments[i].data;
		}
	}
}

function fetch(src) {
	return src;
}
